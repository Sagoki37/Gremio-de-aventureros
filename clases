import sqlite3
from sqlite3 import Error


def insert_hero(conn, hero):
    """Inserta un nuevo h茅roe en la tabla heroes."""
    sql = ''' INSERT INTO heroes(nombre, clase, nivel_experiencia)
              VALUES(?, ?, ?) '''
    cur = conn.cursor()
    try:
        cur.execute(sql, hero)
        conn.commit()
        print(f" H茅roe '{hero[0]}' insertado con ID: {cur.lastrowid}")
        return cur.lastrowid
    except Error as e:
        print(f" Error al insertar h茅roe: {e}")
        return None

def insert_mission(conn, mission):
    """Inserta una nueva misi贸n en la tabla misiones."""
    sql = ''' INSERT INTO misiones(nombre, localizacion, dificultad, recompensa_oro)
              VALUES(?, ?, ?, ?) '''
    cur = conn.cursor()
    try:
        cur.execute(sql, mission)
        conn.commit()
        print(f" Misi贸n '{mission[0]}' insertada con ID: {cur.lastrowid}")
        return cur.lastrowid
    except Error as e:
        print(f" Error al insertar misi贸n: {e}")
        return None

def insert_monster(conn, monster):
    """Inserta un nuevo monstruo en la tabla monstruos."""
    sql = ''' INSERT INTO monstruos(nombre, tipo, nivel_amenaza)
              VALUES(?, ?, ?) '''
    cur = conn.cursor()
    try:
        cur.execute(sql, monster)
        conn.commit()
        print(f" Monstruo '{monster[0]}' insertado con ID: {cur.lastrowid}")
        return cur.lastrowid
    except Error as e:
        print(f" Error al insertar monstruo: {e}")
        return None

def record_hero_participation(conn, participation):
    """Registra la participaci贸n de un h茅roe en una misi贸n (Tabla misiones_heroes)."""
    sql = ''' INSERT INTO misiones_heroes(mision_id, heroe_id)
              VALUES(?, ?) '''
    cur = conn.cursor()
    try:
        cur.execute(sql, participation)
        conn.commit()
        print(f" Participaci贸n registrada: Misi贸n ID {participation[0]} con H茅roe ID {participation[1]}")
    except Error as e:
        print(f" Error al registrar participaci贸n: {e}")

def record_monster_encounter(conn, encounter):
    """Registra los monstruos encontrados en una misi贸n (Tabla misiones_monstruos)."""
    sql = ''' INSERT INTO misiones_monstruos(mision_id, monstruo_id, cantidad)
              VALUES(?, ?, ?) '''
    cur = conn.cursor()
    try:
        cur.execute(sql, encounter)
        conn.commit()
        print(f" Enfrentamiento registrado: Misi贸n ID {encounter[0]} vs {encounter[2]} monstruos (ID {encounter[1]})")
    except Error as e:
        print(f" Error al registrar enfrentamiento: {e}")


def select_all(conn, table_name):
    """Consulta y muestra todos los registros de una tabla."""
    cur = conn.cursor()
    cur.execute(f"SELECT * FROM {table_name}")
    rows = cur.fetchall()
    print(f"\n--- Contenido de la tabla: {table_name} ---")
    for row in rows:
        print(row)
    print("---------------------------------------")


def demonstrate_data_entry(conn):
    if conn is None:
        print("No hay conexi贸n, abortando la demostraci贸n de datos.")
        return

    print("\n\n===  INICIO DE REGISTRO DE AVENTURAS ===")

    print("\n--- Insertando H茅roes ---")
    heroe_gimli_id = insert_hero(conn, ('Gimli', 'Guerrero', 5))
    heroe_elara_id = insert_hero(conn, ('Elara', 'Mago', 8))
    heroe_lyra_id = insert_hero(conn, ('Lyra', 'Arquero', 3))

    print("\n--- Insertando Monstruos ---")
    monstruo_goblin_id = insert_monster(conn, ('Goblin Mayor', 'Goblin', 2))
    monstruo_dragon_id = insert_monster(conn, ('Ignis', 'Drag贸n', 10))
    monstruo_esqueleto_id = insert_monster(conn, ('Esqueleto Armado', 'No-muerto', 1))

    print("\n--- Insertando Misiones ---")
    mision_cueva_id = insert_mission(conn, ('Limpiar Cueva', 'Bosque del Susurro', 'F谩cil', 150))
    mision_volcan_id = insert_mission(conn, ('Matar al Drag贸n', 'Monte del Destino', 'pica', 5000))
    mision_ruinas_id = insert_mission(conn, ('Investigar Ruinas', 'Ruinas Antiguas', 'Media', 450))


    # Misi贸n 1: Limpiar Cueva (Participantes: Gimli y Lyra)
    print("\n--- Registrando Participaci贸n (Misiones_Heroes) ---")
    record_hero_participation(conn, (mision_cueva_id, heroe_gimli_id))
    record_hero_participation(conn, (mision_cueva_id, heroe_lyra_id))

    # Misi贸n 2: Matar al Drag贸n (Participante: Elara)
    record_hero_participation(conn, (mision_volcan_id, heroe_elara_id))

    # Misi贸n 1: Limpiar Cueva (Monstruos: 5 Goblins Mayores)
    print("\n--- Registrando Enfrentamientos (Misiones_Monstruos) ---")
    record_monster_encounter(conn, (mision_cueva_id, monstruo_goblin_id, 5))

    # Misi贸n 2: Matar al Drag贸n (Monstruos: 1 Drag贸n Ignis)
    record_monster_encounter(conn, (mision_volcan_id, monstruo_dragon_id, 1))

    # Misi贸n 3: Investigar Ruinas (Monstruos: 10 Esqueletos)
    record_monster_encounter(conn, (mision_ruinas_id, monstruo_esqueleto_id, 10))

    print("\n\n===  CONSULTA DE DATOS REGISTRADOS ===")
    select_all(conn, 'heroes')
    select_all(conn, 'misiones')
    select_all(conn, 'monstruos')
    select_all(conn, 'misiones_heroes')
    select_all(conn, 'misiones_monstruos')

    print("\n===  FIN DEL REGISTRO ===")



def main():

    DATABASE_NAME = "gremio_aventuras.db"
    conn = None
    try:
        conn = sqlite3.connect(DATABASE_NAME)
        demonstrate_data_entry(conn)
        
    except Error as e:
        print(f"Error principal: {e}")
    finally:
        if conn:
            conn.close()

if __name__ == '__main__':
    main()
